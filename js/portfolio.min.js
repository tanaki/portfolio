var PF=window.PF||{};PF.EventManager=PF.EventManager||$({});PF.Collection=PF.Collection||{};PF.Model=PF.Model||{};PF.View=PF.View||{};PF.Events={INIT_HOME:"INIT_HOME",INIT_ABOUT:"INIT_ABOUT",INIT_WORK:"INIT_WORK",INIT_WORK_DETAIL:"INIT_WORK_DETAIL",INIT_STUFFS:"INIT_STUFFS",INIT_LINKS:"INIT_LINKS",INIT_CREDITS:"INIT_CREDITS"};$(window).ready(function(){PF.AppBackground=new PF.Background;PF.AppRouter=new PF.Router;Backbone.history.start({pushState:true})});PF.Router=Backbone.Router.extend({currentView:null,isInit:false,nav:null,eventHandlers:{},homeView:null,aboutView:null,workView:null,stuffsView:null,routes:{about:"_aboutAction",work:"_workAction","work/:slug":"_workDetailAction",stuffs:"_stuffsAction","stuffs/:slug":"_stuffsAction",links:"_linksAction",credits:"_creditsAction","*actions":"_defaultAction"},_aboutAction:function(){this._displayPage(PF.Events.INIT_ABOUT)},_workAction:function(){this._displayPage(PF.Events.INIT_WORK)},_workDetailAction:function(a){console.log("work detail action",a)},_stuffsAction:function(a){this._displayPage(PF.Events.INIT_STUFFS,a)},_linksAction:function(){this._displayPage(PF.Events.INIT_LINKS)},_creditsAction:function(){this._displayPage(PF.Events.INIT_CREDITS)},_defaultAction:function(){this._displayPage(PF.Events.INIT_HOME)},_displayPage:function(a,b){if(!this.isInit)this._init();if(this.currentView){this.currentView.hide(a)}else{PF.EventManager.trigger(a,[b])}},_init:function(){this.isInit=true;$("html").removeClass("no-js");this._initEventHandlers();this._initExternals();this.nav=new PF.View.Nav},_initEventHandlers:function(){this.eventHandlers[PF.Events.INIT_HOME]=this._initHome;this.eventHandlers[PF.Events.INIT_ABOUT]=this._initAbout;this.eventHandlers[PF.Events.INIT_WORK]=this._initWork;this.eventHandlers[PF.Events.INIT_WORK_DETAIL]=this._initWorkDetail;this.eventHandlers[PF.Events.INIT_STUFFS]=this._initStuffs;this.eventHandlers[PF.Events.INIT_LINKS]=this._initLinks;this.eventHandlers[PF.Events.INIT_CREDITS]=this._initCredits;PF.EventManager.bind(this.eventHandlers)},_initExternals:function(){$('a[rel="external"]').live("click",function(a){a.preventDefault();window.open($(this).attr("href"),"_blank")})},_initHome:function(){var a=PF.AppRouter;if(a.homeView==null)a.homeView=new PF.View.Home;a.homeView.render();a.currentView=a.homeView;a.nav.hide()},_initAbout:function(){var a=PF.AppRouter;if(a.aboutView==null)a.aboutView=new PF.View.About;a.aboutView.render();a.currentView=a.aboutView;a.nav.render("about")},_initWork:function(){var a=PF.AppRouter;if(a.workView==null)a.workView=new PF.View.Work;a.workView.render();a.currentView=a.workView;a.nav.render("work")},_initStuffs:function(a,b){var c=PF.AppRouter;if(c.stuffsView==null)c.stuffsView=new PF.View.Stuffs;c.stuffsView.render(b);c.currentView=c.stuffsView;c.nav.render("stuffs")},_initLinks:function(){var a=PF.AppRouter;if(a.linksView==null)a.linksView=new PF.View.Links;a.linksView.render();a.currentView=a.linksView;a.nav.render("links")}});PF.Collection.WorksCollection=Backbone.Collection.extend({model:PF.Model.Work,initialize:function(){}});PF.Background=function(){var a=null,b=0,c=null,d=false,e=null,f=function(){a=Raphael(document.getElementById("background"),"100%","100%");var b=$(window).width(),d=$(window).height(),e={stroke:"#222222","stroke-width":0,"stroke-opacity":0,fill:"#222222"};c=a.path("M0,0L"+b+",0 "+b+","+d+" 0,"+d+"Z").attr(e);window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();i();$(window).resize(function(){j()})},g=function(a){return Math.floor(a*(Math.random()%1))},h=function(a,b){return a+g(b-a+1)},i=function(){var a=3500;c.animate({transform:"r0"},a,function(){b=b>0?h(40,100)*-.01:h(40,100)*.01;c.animate({transform:"r"+b},a,function(){i()})})},j=function(){var a=$(window).width(),b=$(window).height();c.attr("path","M0,0L"+a+",0 "+a+","+b+" 0,"+b+"Z")};f()};PF.Collection.LinksCollection=Backbone.Collection.extend({model:PF.Model.Link,initialize:function(){}});PF.Collection.StuffsCollection=Backbone.Collection.extend({model:PF.Model.Stuff,initialize:function(){}});PF.Model.Link=Backbone.Model.extend({defaults:{url:"name.com",type:"az",slug:"az",isSubtitle:false,"class":false},initialize:function(){}});PF.Model.Stuff=Backbone.Model.extend({defaults:{index:0,slug:"stuff",title:"Stuff",top:"40%",date:"11.2011",img:"",text:"description of the stuff",tags:[]},initialize:function(){}});PF.Model.Work=Backbone.Model.extend({defaults:{index:0,color:"ffffff",slug:"project",title:"Project",featured:false,context:null,link:null,linkText:"",white:false,videoType:null,videoId:null,text:"description of the project",tags:[]},initialize:function(){}});PF.View.About=Backbone.View.extend({el:"#page .content",tpl_about:null,hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_about){a._display()}else{$.loadTemplate({template:"template_about",file:"/templates/about.html",callback:function(b){a.tpl_about=b;a._display()},noStorage:true})}},_display:function(){var a=_.template(this.tpl_about);$(this.el).html(a()).fadeIn(300)}});PF.View.Credits=Backbone.View.extend({el:".main-content",tpl_credits:null,hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){var a=this;$.loadTemplate({template:"template_credits",file:"/templates/credits.html",callback:function(b){a.tpl_credits=b;a._display()},noStorage:true})},_display:function(){var a=_.template(this.tpl_credits);$(this.el).html(a())}});PF.View.Home=Backbone.View.extend({container:"main-canvas",el:"#page .content",R:null,isMenu:false,isDragging:false,square:null,blob:null,pull:null,pullLabel:null,pullCircle:null,pullHelp:null,squareHelp:null,circleHelp:null,circles:null,labels:null,areas:null,winWidth:0,winHeight:0,offsetX:-90,offsetY:-20,nameX:0,nameY:0,halfWidth:0,initialOffset:102,offsetLeftX:0,initialize:function(){var a=this;a.winWidth=$(window).width();a.winHeight=$(window).height();a.nameX=Math.round(a.winWidth*.89);a.nameY=Math.round(a.winHeight*.49);a.halfWidth=Math.round(a.winHeight/2);a.offsetLeftX=Math.round(a.winWidth*.15);$(window).resize(function(){a.winWidth=$(window).width();a.winHeight=$(window).height();a.halfWidth=Math.round(a.winHeight/2);a.nameX=Math.round(a.winWidth*.89);a.nameY=Math.round(a.winHeight*.49);a.offsetLeftX=Math.round(a.winWidth*.15);if(a.isMenu){a._moveMenu()}else{if(a.R)a.R.clear();$("#"+a.container).empty();a._initRaphael()}})},hide:function(a){var b=this;if(b.circles){$.each(b.circles,function(c,d){d.animate({cx:c*30+15,cy:b.halfWidth},c*100+300,function(){if(c==b.circles.length-1){$(b.el).fadeOut(300,function(){b.isMenu=false;b.R.clear();$("#"+b.container).empty();if(a)PF.EventManager.trigger(a)})}});if(b.areas[c])b.areas[c].remove();if(b.labels[c])b.labels[c].remove();if(c==0){b.square.animate({opacity:0},200,function(){b.square.remove()});b.blob.animate({cx:180,cy:b.halfWidth,opacity:0,transform:"s0.2,0.2"},600,function(){b.blob.remove()})}})}else{$(b.el).fadeOut(300,function(){b.isMenu=false;b.R.clear();$(this).empty();if(a)PF.EventManager.trigger(a)})}},render:function(){$("body").attr("class","");$(this.el).empty();this._initRaphael()},_initRaphael:function(){this.R=Raphael(document.getElementById(this.container),"100%","100%");this._initGraphics()},_initGraphics:function(){var a=this,b=a.nameX+a.offsetX,c=a.nameY+a.offsetY,d={x:b+a.initialOffset,y:c},e={x:b+a.offsetLeftX,y:-100},f={x:a.winWidth+200,y:c},g={x:b+a.offsetLeftX,y:a.winHeight+100};a.blob=a.R.path(a._getBlobPath(f,g,d,e,0));a.blob.attr({fill:"#161616","stroke-width":"0","stroke-opacity":"0"});a.square=a.R.path("M"+d.x+","+d.y+"L"+e.x+","+e.y+"L"+f.x+","+f.y+"L"+g.x+","+g.y+"Z").attr({stroke:"#666","stroke-width":"1"});a.squareHelp=a.R.path("M"+e.x+","+e.y+"L"+d.x+","+d.y+"L"+g.x+","+g.y).attr({stroke:"#444","stroke-width":"1",opacity:0});a.pullHelp=a.R.text(b+80,c,"Pull").attr({font:"8px Copy0855",fill:"#ffffff",cursor:"pointer",opacity:0});a.pullLabel=a.R.text(b+50,c,"Nicolas Pigelet").attr({font:"8px Copy0855",fill:"#ffffff",cursor:"pointer"});a.pullCircle=a.R.circle(b+102,c,5).attr({fill:"#ddd","stroke-width":0,"stroke-opacity":0});a.circleHelp=a.R.circle(b+102,c,5).attr({fill:"#777","stroke-width":0,"stroke-opacity":0,opacity:0});a.pull=a.R.rect(b,c-40,120,80).attr({fill:"#222",opacity:0,"stroke-width":0,"stroke-opacity":0,cursor:"pointer"});a.pull.drag(a._handleMove,a._handleStart,a._handleStop,a);a.pull.mouseover(function(){a._mouseOver(a)}).mouseout(function(){a._mouseOut(a)})},_mouseOver:function(a){if(a.isDragging)return;var b=a.nameX+a.offsetX;a.pullLabel.animate({x:b+30,opacity:0},100);a.pullHelp.animate({x:b+50,opacity:1},100);a.squareHelp.animate({opacity:1,transform:"t-100,0"},100);a.circleHelp.animate({opacity:1,transform:"t-100,0"},100)},_mouseOut:function(a){if(a.isDragging)return;var b=a.nameX+a.offsetX;a.pullLabel.animate({x:b+50,opacity:1},100);a.pullHelp.animate({x:b+80,opacity:0},100);a.squareHelp.animate({opacity:0,transform:"t0,0"},100);a.circleHelp.animate({opacity:0,transform:"t0,0"},100)},_handleMove:function(a,b,c,d,e,f){this._move(false,a,b)},_handleStart:function(){this._mouseOut(this);this.isDragging=true},_handleStop:function(a){var b=this;if(a.pageX<Math.round(b.winWidth*.66)){b.isMenu=true;b.pull.undrag()}else{b.pull.mouseover(function(){b._mouseOver(b)}).mouseout(function(){b._mouseOut(b)})}this._move(true,0,0)},_move:function(a,b,c){var d=this,e=d._getLatestCoords(b,c);if(a){var f=300,g="easeOut";d.pull.animate({x:e.pullX,y:e.pullY-40},f,g);d.pullLabel.animate({x:e.pullX+50,y:e.pullY},f,g);d.pullCircle.animate({cx:e.pullX+102,cy:e.pullY},f,g);d.square.animate({path:e.path},f,g);d.blob.animate({path:e.blobPath},f,g,function(){if(d.isMenu){d._initMenu(e.left,e.top,e.right,e.bottom,e.center)}d.isDragging=false})}else{d.pull.attr({x:e.pullX,y:e.pullY-40});d.pullLabel.attr({x:e.pullX+50,y:e.pullY});d.pullCircle.attr({cx:e.pullX+102,cy:e.pullY});d.square.attr("path",e.path);d.blob.attr("path",e.blobPath)}},_getBlobPath:function(a,b,c,d,e){var f=Math.abs(e/10)+20,g={x:Math.round((c.x+d.x)/2),y:Math.round((c.y+d.y)/2)},h={x:Math.round((a.x+d.x)/2),y:Math.round((a.y+d.y)/2)},i={x:Math.round((c.x+b.x)/2),y:Math.round((c.y+b.y)/2)},j={x:Math.round((a.x+b.x)/2),y:Math.round((a.y+b.y)/2)};var k="";k+="M"+(a.x-f)+","+a.y;k+="R"+j.x+","+j.y;k+=","+b.x+","+(b.y-f);k+=","+i.x+","+i.y;k+=","+(c.x+f)+","+c.y;k+=","+g.x+","+g.y;k+=","+d.x+","+(d.y+f);k+=","+h.x+","+h.y;k+=","+(a.x-f)+","+a.y;return k},_initMenu:function(a,b,c,d,e){var f=this;if(f.pull){f.pull.remove();f.pull=null}if(f.pullCircle){f.pullCircle.remove();f.pullCircle=null}if(f.pullLabel){f.pullLabel.animate({opacity:0},300,function(){f.pullLabel.remove();f.pullLabel=null})}if(f.blob&&f.blob.type!="circle"){f.blob.remove();f.blob=f.R.circle(e.x,e.y,79).attr({scale:[.1,.1],fill:"#161616","stroke-width":"0","stroke-opacity":"0"})}else{f.blob.attr({cx:e.x,cy:e.y})}var g={fill:"#ddd","stroke-width":0,"stroke-opacity":0,opacity:.5},h={fill:"#333",opacity:0,"stroke-width":0,"stroke-opacity":0,cursor:"pointer"},i={font:"8px Copy0855",fill:"#ffffff",cursor:"pointer",opacity:0},j=[a,d,c,b],k=["about","work","stuffs","links"];var l=f.R.circle(a.x,a.y,3).attr(g),m=f.R.circle(d.x,d.y,3).attr(g),n=f.R.circle(c.x,c.y,3).attr(g),o=f.R.circle(b.x,b.y,3).attr(g);var p=f.R.text(a.x-30,a.y,"About").attr(i),q=f.R.text(d.x,d.y+20,"Work").attr(i),r=f.R.text(c.x+30,c.y,"Stuffs").attr(i),s=f.R.text(b.x,b.y-20,"Links").attr(i);var t=f.R.rect(a.x-100,a.y-50,120,100).attr(h).toFront(),u=f.R.rect(d.x-50,d.y-20,100,120).attr(h).toFront(),v=f.R.rect(c.x-20,c.y-50,120,100).attr(h).toFront(),w=f.R.rect(b.x-50,b.y-100,100,120).attr(h).toFront();f.circles=[l,m,n,o];f.labels=[p,q,r,s];f.areas=[t,u,v,w];$.each(f.areas,function(e,g){f._addEvents(e,g,f.circles,f.labels,j,k,a,b,c,d)})},_addEvents:function(a,b,c,d,e,f,g,h,i,j){var k=this;b.mousemove(function(b,e,f){var l=e+30,m=f,n=e,o=f,p="M"+l+","+m+"L"+h.x+","+h.y+"L"+i.x+","+i.y+"L"+j.x+","+j.y+"Z";if(a==1){l=e;m=f-20;p="M"+g.x+","+g.y+"L"+h.x+","+h.y+"L"+i.x+","+i.y+"L"+l+","+m+"Z"}else if(a==2){l=e-30;p="M"+g.x+","+g.y+"L"+h.x+","+h.y+"L"+l+","+m+"L"+j.x+","+j.y+"Z"}else if(a==3){l=e;m=f+20;p="M"+g.x+","+g.y+"L"+l+","+m+"L"+i.x+","+i.y+"L"+j.x+","+j.y+"Z"}c[a].attr({cx:l,cy:m,opacity:1});d[a].attr({x:n,y:o,opacity:1});k.square.attr({path:p})}).mouseout(function(){var b=200;c[a].animate({cx:e[a].x,cy:e[a].y,opacity:.5},b);var f=g.x-30,l=g.y;if(a==1){f=j.x;l=j.y+20}else if(a==2){f=i.x+30;l=i.y}else if(a==3){f=h.x;l=h.y-20}d[a].animate({x:f,y:l,opacity:0},b);var m="M"+g.x+","+g.y+"L"+h.x+","+h.y+"L"+i.x+","+i.y+"L"+j.x+","+j.y+"Z";k.square.animate({path:m},b)}).click(function(){PF.AppRouter.navigate(f[a],true)})},_moveMenu:function(){var a=this._getLatestCoords();this.square.attr({path:a.path});$.each(this.circles,function(a,b){if(b)b.remove()});$.each(this.areas,function(a,b){if(b)b.remove()});$.each(this.labels,function(a,b){if(b)b.remove()});this._initMenu(a.left,a.top,a.right,a.bottom,a.center)},_getLatestCoords:function(a,b){var c={},d=a||0,e=b||0;c.pullX=this.isMenu?Math.round(this.winWidth*.33):this.nameX+d+this.offsetX;c.pullY=this.nameY+e+this.offsetY;c.halfY=this.nameY+this.offsetY;c.middleX=this.nameX+Math.round(d/3)+this.offsetX;c.left={x:c.pullX+this.initialOffset,y:c.pullY};c.top={x:this.isMenu?c.left.x+70:c.middleX+this.offsetLeftX,y:this.isMenu?c.pullY-140:-100};c.right={x:this.isMenu?c.left.x+216:this.winWidth+200,y:this.isMenu?c.left.y-57:c.halfY};c.bottom={x:this.isMenu?c.left.x+135:c.middleX+this.offsetLeftX,y:this.isMenu?c.left.y+85:this.winHeight+100};c.center={x:Math.round((c.left.x+c.right.x)/2)-1,y:Math.round((c.top.y+c.bottom.y)/2)};c.path="M"+c.left.x+","+c.left.y;c.path+="L"+c.top.x+","+c.top.y;c.path+="L"+c.right.x+","+c.right.y;c.path+="L"+c.bottom.x+","+c.bottom.y+"Z";c.blobPath=this._getBlobPath(c.right,c.bottom,c.left,c.top,d);return c}});PF.View.Links=Backbone.View.extend({el:"#page .content",page:"#page",tpl_links:null,collection:null,initialize:function(){var a=this;$(".link-az").live("click",function(b){b.preventDefault();a.toggleLists(this,true)});$(".link-gobelins").live("click",function(b){b.preventDefault();a.toggleLists(this,false)});$(".container ul li a").live("mouseover",function(){var a="/img/links/external/"+$(this).data("slug")+".jpg";$("nav .selected span").css({"background-image":"url("+a+")","background-position":"50% -5px"})}).live("mouseout",function(){$("nav .selected span").css({"background-position":"50% 100px"})})},toggleLists:function(a,b){if($(a).hasClass("selected"))return;$(".content .selected").removeClass("selected");$(a).addClass("selected");var c=b?"0px":"-127px";$(".container").animate({"margin-left":c},270);$(".a-z ul").animate({opacity:b?1:0});$(".gobelins ul").animate({opacity:b?0:1});$(".line").toggleClass("line-toggled")},hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_links){a._loadData()}else{$.loadTemplate({template:"template_links",file:"/templates/links.html",callback:function(b){a.tpl_links=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(a.collection){a._display()}else{a.collection=new PF.Collection.LinksCollection;$.ajax({dataType:"json",url:"/data/links.json",success:function(b){_.each(b.az,function(b,c){a.collection.add(new PF.Model.Link({name:b.name,url:b.url,slug:b.slug,type:"az"}))});_.each(b.gobelins,function(b,c){a.collection.add(new PF.Model.Link({name:b.name,type:"gobelins",isSubtitle:true,"class":c!=0}));_.each(b.people,function(b){a.collection.add(new PF.Model.Link({name:b.name,url:b.url,slug:b.slug,type:"gobelins"}))})});a._display()}})}},_display:function(){var a=this,b={links:this.collection.models},c=_.template(this.tpl_links);if($(".line").length==0)$(a.page).append('<div class="line"></div>');else $(".line").removeClass("line-toggled");$(this.el).html(c(b)).fadeIn(300)}});PF.View.Nav=Backbone.View.extend({nav:"nav",footer:"footer",breadcrumb:".breadcrumb",currentViewID:null,initialize:function(){var a=this;$("nav a:not(.selected)").live({mouseenter:function(){if($(".breadcrumb .link").length>1)$(".breadcrumb .link:last").hide(200);var a=$("span",this).text();a.shuffle($(".breadcrumb .current"))},mouseleave:function(){if($(".breadcrumb .link").length>1)$(".breadcrumb .link:last").show(200);a.breadcrumbText=a.currentViewID.capitalize();a.breadcrumbText.shuffle($(".breadcrumb .current"))}});$("nav a").click(function(a){a.preventDefault();if($(this).hasClass("selected"))return;PF.AppRouter.navigate($(this).attr("href"),true)});$(".link-first").live("click",function(a){a.preventDefault();PF.AppRouter.navigate("/",true)})},order:function(a){$("body").attr("class","").addClass("page-"+a);$(".selected",this.nav).removeClass("selected");$("#"+a).removeClass("first").removeClass("second").removeClass("third").addClass("selected");$("a:not(.selected)",this.nav).each(function(a,b){$(b).removeClass("first").removeClass("second").removeClass("third").addClass(a==0?"first":a==1?"second":"third");$("span",b).css("background-image","")});return this},updateBreadcrumb:function(a){this.breadcrumbText=a.capitalize();$(".current",this.breadcrumb).text(this.breadcrumbText)},hide:function(){$(this.nav).fadeOut(200);$(this.footer).fadeOut(200);$(this.breadcrumb).fadeOut(200)},render:function(a){if($(this.nav).hasClass("hidden")){$(this.nav).css("visibility","visible").fadeIn(200,function(){$(this).removeClass("hidden")})}if($(this.footer).hasClass("hidden")){$(this.footer).css("visibility","visible").fadeIn(200,function(){$(this).removeClass("hidden")})}if($(this.breadcrumb).hasClass("hidden")){$(this.breadcrumb).css("visibility","visible").fadeIn(200,function(){$(this).removeClass("hidden")})}if(a){this.order(a);this.updateBreadcrumb(a);this.currentViewID=a}}});PF.View.Stuffs=Backbone.View.extend({el:"#page .content",tpl_stuffs:null,collection:null,currentSlug:null,initialize:function(){var a=this;$(window).resize(function(){$(a.el).css("width",$(window).width()-545);a._updateNavPos(true)})},hide:function(a){$(this.el).hide().css("width","");if(a)PF.EventManager.trigger(a)},render:function(a){this.currentSlug=a||null;this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_stuffs){a._loadData()}else{$.loadTemplate({template:"template_stuffs",file:"/templates/stuffs.html",callback:function(b){a.tpl_stuffs=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(a.collection){a._display()}else{a.collection=new PF.Collection.StuffsCollection;$.ajax({dataType:"json",url:"/data/stuffs.json",success:function(b){$.each(b.stuffs,function(b,c){a.collection.add(new PF.Model.Stuff({index:c.index,slug:c.slug,title:c.title,top:c.top,date:c.date,img:c.img,text:c.text,tags:c.tags}))});a._display()}})}},_updateImage:function(){var a=$(".content ul li:not(.hidden)").data("img");$("nav .selected span").css("background-image","url(/img/stuffs/"+a+")")},_updateNavPos:function(a){var b=this.collection.length*35+85,c=Math.floor(this.collection.length/2),d=$(".nav-stuffs li.current").data("index"),e=Math.round(($(window).height()-b)/2),f=35*(c-d);if(a)$(".nav-stuffs").css("top",Math.round(e+f));else $(".nav-stuffs").animate({top:Math.round(e+f)},200)},_initNavLinks:function(){var a=this;$(".nav-stuffs a").click(function(b){b.preventDefault();PF.AppRouter.navigate($(this).attr("href"));a._changePartial($(this).data("slug"))})},_display:function(){var a=this,b={stuffs:this.collection.models,selectedSlug:this.currentSlug,baseTop:Math.round($(window).height()/2)},c=_.template(this.tpl_stuffs);$(this.el).html(c(b)).fadeIn(300,function(){a._initNavLinks();a._updateImage();a._updateNavPos(true);$(window).resize()})},_changePartial:function(a){var b=$("ul.articles li:not(.hidden)"),c=$("ul.articles li[data-slug="+a+"]"),d=b.data("slug"),e=b.data("index"),f=c.data("index"),g=$("ul.nav-stuffs li.current"),h=$("ul.nav-stuffs li[data-index="+f+"]"),i=$("span.stuff-content",b),j=$("span.stuff-content",c);if(a==d)return;g.removeClass("current");h.addClass("current");this._updateNavPos();var k=this;i.animate({opacity:0,top:e>f?"70%":"30%"},400,function(){b.addClass("hidden");k._updateImage();i.css({top:i.data("top"),opacity:1})});c.removeClass("hidden");j.css({top:e>f?"30%":"70%",opacity:0}).animate({opacity:1,top:j.data("top")},400)}});PF.View.Work=Backbone.View.extend({el:"#page .content",tpl_work:null,collection:null,lines:null,ordered:null,percent:null,connection:null,offsetX:0,offsetY:0,width:Math.round($(window).width()/2),height:Math.round($(window).height()/2),initialize:function(){var a=this;$(window).resize(function(){var b=$("#works-lines").position();a.offsetX=b.left;a.offsetY=b.top;a._drawLinks(true)})},hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_work){a._loadData()}else{$.loadTemplate({template:"template_work",file:"/templates/work.html",callback:function(b){a.tpl_work=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(this.collection){a._display()}else{a.collection=new PF.Collection.WorksCollection;$.ajax({dataType:"json",url:"/data/works.json",success:function(b){$.each(b.projects,function(b,c){a.collection.add(new PF.Model.Work({index:c.index,color:c.color,name:c.slug,slug:c.slug,title:c.title,featured:c.featured,context:c.context,link:c.link,linkText:c.linkText,white:c.white,videoType:c.videoType,videoId:c.videoId,text:c.text,tags:c.tags}))});a._display()}})}},_display:function(){var a=this,b={projects:this.collection.models},c=_.template(this.tpl_work);$(this.el).html(c(b)).fadeIn(300,function(){var b=$("#works-lines").position();a.offsetX=b.left;a.offsetY=b.top;a._drawLinks()})},_drawLinks:function(a){if(this.lines)this.lines.clear();else this.lines=Raphael(document.getElementById("works-lines"),"100%","100%");var b=this,c="";this.width=Math.round($(window).width()/2),this.height=Math.round($(window).height()/2);this.connection=this.lines.path(c).attr({stroke:"#333"});if(a){$.each(this.percent,function(a,d){var e=Math.round(d[0]*b.width/100)+25,f=Math.round(d[1]*b.height/100)+25;if(a==0)c="M"+e+","+f;else if(a==1)c+="L"+e+","+f;else c+=" "+e+","+f;b.connection.attr("path",c);b._drawLink(b.collection.models[a],a,false)})}else{this.ordered=[],this.percent=[];var d=[20,30,40,50,60,70,80,85,90],e=[10,20,30,40,50,60,70,80,85];d=$.shuffle(d);e=$.shuffle(e);$.each(this.collection.models,function(a,f){var g=Math.round(d[a]*b.width/100)+25,h=Math.round(e[a]*b.height/100)+25;b.ordered.push([g,h]);b.percent.push([d[a],e[a]]);setTimeout(function(){if(a==0)c="M"+g+","+h;else if(a==1)c+="L"+g+","+h;else c+=" "+g+","+h;b.connection.animate({path:c},150);setTimeout(function(){b._drawLink(f,a,true)},200)},a*200)})}},_drawLink:function(a,b,c){var d=this,e={stroke:"#666","stroke-opacity":0,"stroke-width":0,opacity:.3,fill:"#666"},f={opacity:.3,stroke:"#444","stroke-width":1},g={stroke:"#666","stroke-opacity":0,"stroke-width":0,fill:"#666",opacity:0,cursor:"pointer"},h=a.attributes.featured?5:3,i=a.attributes.featured?8:5,j=Math.round(d.percent[b][0]*d.width/100)+25,k=Math.round(d.percent[b][1]*d.height/100)+25,l=this.lines.circle(j,k,h).attr(e),m=this.lines.circle(j,k,h+i).attr(f),n=this.lines.circle(j,k,h+i*4).attr(g),o="";$.each(d.percent,function(a,b){o+=(a==0?"M":"L")+(Math.round(b[0]*d.width/100)+25)+","+(Math.round(b[1]*d.height/100)+25)});if(c){l.scale(0,0).animate({transform:"s1,1"},500,"easeout");m.scale(0,0).animate({transform:"s1,1"},500)}$(n).data("link",a.attributes);n.mouseover(function(){l.attr("opacity",1);m.attr("opacity",1);$(".breadcrumb .current:first").removeClass("current").addClass("link");setTimeout(function(){$(".breadcrumb .link:last").css("font-family","Copy0855")},180);$("<span> / </span>").appendTo($(".breadcrumb .link:last"));var a=$(this).data("link");$('<li class="current">'+a.title.substring(0,2)+"</li>").appendTo($(".breadcrumb")).show();a.title.shuffle($(".breadcrumb .current:last"));var b="/img/work/projects/"+a.slug+".jpg";$("nav .selected span").css({"background-image":"url("+b+")","background-position":"50% -5px"})}).mouseout(function(){l.animate({cx:j,cy:k,opacity:.3},200);m.animate({cx:j,cy:k,opacity:.3},200);d.connection.animate({path:o},200);$(".breadcrumb .link:last").removeClass("link").addClass("current").css("font-family","");$(".breadcrumb .current:first span").remove();$(".breadcrumb .current:last").remove();$("nav .selected span").css({"background-position":"50% 100px"})}).mousemove(function(a,c,e){var f=c-d.offsetX,g=e-d.offsetY+20;l.attr({cx:f,cy:g});m.attr({cx:f,cy:g});var h="";$.each(d.percent,function(a,c){var e=Math.round(c[0]*d.width/100)+25,i=Math.round(c[1]*d.height/100)+25;h+=(a==0?"M":"L")+(a==b?f+","+g:e+","+i)});d.connection.attr("path",h)}).click(function(){console.log(a.attributes.slug)})}});PF.View.WorkDetail=Backbone.View.extend({el:".main-content",tpl_work_detail:null,collection:null,hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){console.log("boum")},_display:function(){}})