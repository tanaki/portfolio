var PF=window.PF||{};PF.EventManager=PF.EventManager||$({});PF.Collection=PF.Collection||{};PF.Model=PF.Model||{};PF.View=PF.View||{};PF.Events={INIT_HOME:"INIT_HOME",INIT_ABOUT:"INIT_ABOUT",INIT_WORK:"INIT_WORK",INIT_WORK_DETAIL:"INIT_WORK_DETAIL",INIT_STUFFS:"INIT_STUFFS",INIT_LINKS:"INIT_LINKS"};$(window).ready(function(){PF.AppBackground=new PF.Background;PF.AppRouter=new PF.Router;Backbone.history.start({pushState:true})});PF.Router=Backbone.Router.extend({currentView:null,isInit:false,nav:null,eventHandlers:{},homeView:null,aboutView:null,workView:null,workDetailView:null,stuffsView:null,linksView:null,routes:{about:"_aboutAction",work:"_workAction","work/:slug":"_workDetailAction",stuffs:"_stuffsAction","stuffs/:slug":"_stuffsAction",links:"_linksAction","*actions":"_defaultAction"},_aboutAction:function(){this._displayPage(PF.Events.INIT_ABOUT)},_workAction:function(){this._displayPage(PF.Events.INIT_WORK)},_workDetailAction:function(a){if(this.currentView!==null&&this.currentView===this.workView)this._displayPage(PF.Events.INIT_WORK_DETAIL,a);else this._displayPage(PF.Events.INIT_WORK,a)},_stuffsAction:function(a){this._displayPage(PF.Events.INIT_STUFFS,a)},_linksAction:function(){this._displayPage(PF.Events.INIT_LINKS)},_defaultAction:function(){this._displayPage(PF.Events.INIT_HOME)},_displayPage:function(a,b){if(!this.isInit)this._init();if(this.currentView&&a!==PF.Events.INIT_WORK_DETAIL){this.currentView.hide(a)}else{var c=a==PF.Events.INIT_WORK_DETAIL?this.workView.collection:null;PF.EventManager.trigger(a,[b,c])}},_init:function(){this.isInit=true;$("html").removeClass("no-js");this._initEventHandlers();this._initAnchorTags();this._initCredits();this.nav=new PF.View.Nav},_initEventHandlers:function(){this.eventHandlers[PF.Events.INIT_HOME]=this._initHome;this.eventHandlers[PF.Events.INIT_ABOUT]=this._initAbout;this.eventHandlers[PF.Events.INIT_WORK]=this._initWork;this.eventHandlers[PF.Events.INIT_WORK_DETAIL]=this._initWorkDetail;this.eventHandlers[PF.Events.INIT_STUFFS]=this._initStuffs;this.eventHandlers[PF.Events.INIT_LINKS]=this._initLinks;PF.EventManager.bind(this.eventHandlers)},_initAnchorTags:function(){$("body").delegate('a[rel="external"]',"click",function(a){a.preventDefault();window.open($(this).attr("href"),"_blank")});$("body").delegate('a[rel="internal"]',"click",function(a){a.preventDefault();PF.AppRouter.navigate($(this).attr("href"),true)})},_initCredits:function(){var a=null;$("footer").delegate('a[rel="credits"]',"click",function(b){b.preventDefault();clearTimeout(a);$("footer ul").animate({opacity:0},300);$("footer #credits").css({opacity:0,display:"block"}).animate({opacity:1,top:0},300);a=setTimeout(function(){$("footer ul").animate({opacity:1},300);$("footer #credits").animate({opacity:0,top:20,display:"none"},300)},4e3)})},_initHome:function(){var a=PF.AppRouter;if(a.homeView==null)a.homeView=new PF.View.Home;a.homeView.render();a.currentView=a.homeView;a.nav.hide()},_initAbout:function(){var a=PF.AppRouter;if(a.aboutView==null)a.aboutView=new PF.View.About;a.aboutView.render();a.currentView=a.aboutView;a.nav.render("about")},_initWork:function(a,b){var c=PF.AppRouter;if(c.workView==null)c.workView=new PF.View.Work;c.workView.render(b);c.currentView=c.workView;c.nav.render("work")},_initWorkDetail:function(a,b,c){var d=PF.AppRouter;if(d.workDetailView==null)d.workDetailView=new PF.View.WorkDetail;d.workDetailView.render(b,c);d.currentView=d.workDetailView},_initStuffs:function(a,b){var c=PF.AppRouter;if(c.stuffsView==null)c.stuffsView=new PF.View.Stuffs;c.stuffsView.render(b);c.currentView=c.stuffsView;c.nav.render("stuffs")},_initLinks:function(){var a=PF.AppRouter;if(a.linksView==null)a.linksView=new PF.View.Links;a.linksView.render();a.currentView=a.linksView;a.nav.render("links")}});PF.Background=function(){var a=null,b=0,c=null,d=false,e=null,f=function(){a=Raphael(document.getElementById("background"),"100%","100%");var b=$(window).width(),d=$(window).height(),e={stroke:"#222222","stroke-width":0,"stroke-opacity":0,fill:"#222222"};c=a.path("M0,0L"+b+",0 "+b+","+d+" 0,"+d+"Z").attr(e);window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();i();$(window).resize(function(){j()})},g=function(a){return Math.floor(a*(Math.random()%1))},h=function(a,b){return a+g(b-a+1)},i=function(){var a=3500;c.animate({transform:"r0"},a,function(){b=b>0?h(40,100)*-.01:h(40,100)*.01;c.animate({transform:"r"+b},a,function(){i()})})},j=function(){var a=$(window).width(),b=$(window).height();c.attr("path","M0,0L"+a+",0 "+a+","+b+" 0,"+b+"Z")};f()};PF.Collection.LinksCollection=Backbone.Collection.extend({model:PF.Model.Link,initialize:function(){}});PF.Collection.WorksCollection=Backbone.Collection.extend({model:PF.Model.Work,initialize:function(){}});PF.Collection.StuffsCollection=Backbone.Collection.extend({model:PF.Model.Stuff,initialize:function(){}});PF.Model.Link=Backbone.Model.extend({defaults:{url:"name.com",type:"az",slug:"az",isSubtitle:false,"class":false},initialize:function(){}});PF.Model.Stuff=Backbone.Model.extend({defaults:{index:0,slug:"stuff",title:"Stuff",top:"40%",date:"11.2011",img:"",videoType:null,videoId:null,text:"description of the stuff",tags:[]},initialize:function(){}});PF.Model.Work=Backbone.Model.extend({defaults:{index:0,position:[],color:"ffffff",slug:"project",title:"Project",featured:false,context:null,link:null,linkText:"",white:false,videoType:null,videoId:null,text:"description of the project",tags:[],slides:[]},initialize:function(){}});PF.View.About=Backbone.View.extend({el:"#page .content",tpl_about:null,imgPath:"/img/about/portrait.png",aboutText:null,hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_about){a._loadData()}else{$.loadTemplate({template:"template_about",file:"/templates/about.html",callback:function(b){a.tpl_about=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(a.aboutText){a._display()}else{$.ajax({dataType:"json",url:"/data/about.json",success:function(b){a.aboutText=b.about;var c=new Image;c.onload=a._display();c.src=a.imgPath}})}},_display:function(){var a={about:this.aboutText},b=_.template(this.tpl_about);$(".content-loading").hide();$(this.el).html(b(a)).fadeIn(300)}});PF.View.Home=Backbone.View.extend({container:"home",el:"#page .content",$container:null,$el:null,R:null,isMenu:false,isDragging:false,line:null,square:null,blob:null,pull:null,pullLabel:null,pullCircle:null,pullHelp:null,squareHelp:null,circleHelp:null,circles:null,labels:null,areas:null,images:null,winWidth:0,winHeight:0,offsetX:-90,offsetY:-20,nameX:0,nameY:0,halfWidth:0,initialOffset:102,offsetLeftX:0,$window:null,$body:null,initialize:function(){var a=this;a.$window=$(window);a.$body=$("body");a.winWidth=a.$window.width();a.winHeight=a.$window.height();a.nameX=Math.round(a.winWidth*.89);a.nameY=Math.round(a.winHeight*.49);a.halfWidth=Math.round(a.winHeight/2);a.offsetLeftX=Math.round(a.winWidth*.15);a.$window.resize(function(){if(!a.$body.hasClass("page-about")&&!a.$body.hasClass("page-links")&&!a.$body.hasClass("page-stuffs")&&!a.$body.hasClass("page-work")){a.winWidth=a.$window.width();a.winHeight=a.$window.height();a.halfWidth=Math.round(a.winHeight/2);a.nameX=Math.round(a.winWidth*.89);a.nameY=Math.round(a.winHeight*.49);a.offsetLeftX=Math.round(a.winWidth*.15);if(a.isMenu){a._moveMenu()}else{if(a.R)a.R.clear();a.$container.empty();a._initRaphael(false)}}})},hide:function(a){var b=this;if(b.circles){$.each(b.circles,function(c,d){d.animate({cx:c*30+15,cy:b.halfWidth},c*100+300,function(){if(c==b.circles.length-1){b.$el.fadeOut(300,function(){b.isMenu=false;b.R.clear();b.$container.empty();if(a)PF.EventManager.trigger(a)})}});if(b.areas[c])b.areas[c].remove();if(b.labels[c])b.labels[c].remove();if(c==0){b.square.animate({opacity:0},200,function(){b.square.remove()});b.blob.animate({cx:180,cy:b.halfWidth,opacity:0,transform:"s0.2,0.2"},600,function(){b.blob.remove()})}})}else{b.$el.fadeOut(300,function(){b.isMenu=false;b.R.clear();b.$el.empty();if(a)PF.EventManager.trigger(a)})}},render:function(){this.$body.attr("class","");this.$container=$("#"+this.container);this.$el=$(this.el);this.$el.empty();this._initRaphael(true)},_initRaphael:function(a){this.R=Raphael(document.getElementById(this.container),"100%","100%");this._initGraphics(a)},_initGraphics:function(a){var b=this,c=b.nameX+b.offsetX,d=b.nameY+b.offsetY,e={x:c+b.initialOffset,y:d},f={x:c+b.offsetLeftX,y:-100},g={x:b.winWidth+200,y:d},h={x:c+b.offsetLeftX,y:b.winHeight+100},i={x:e.x+150,y:e.y},j={x:f.x+50,y:f.y},k={x:h.x+50,y:h.y};b.line=b.R.path("M66,"+b.winHeight+"L0,0").attr({stroke:"#444","stroke-width":"1"});b.blob=b.R.path(b._getBlobPath(g,a?k:h,a?i:e,a?j:f,0));b.blob.attr({fill:"#161616","stroke-width":"0","stroke-opacity":"0"});b.square=b.R.path("M"+(a?i.x:e.x)+","+e.y+"L"+(a?j.x:f.x)+","+f.y+"L"+g.x+","+g.y+"L"+(a?k.x:h.x)+","+h.y+"Z").attr({stroke:"#666","stroke-width":"1"});b.squareHelp=b.R.path("M"+f.x+","+f.y+"L"+e.x+","+e.y+"L"+h.x+","+h.y).attr({stroke:"#444","stroke-width":"1",opacity:0});b.pullHelp=b.R.text(c+80,d,"Pull").attr({font:"8px Copy0855",fill:"#ffffff",cursor:"pointer",opacity:0});b.pullLabel=b.R.text(a?c+100:c+50,d,"Nicolas Pigelet").attr({font:"8px Copy0855",fill:"#ffffff",cursor:"pointer"});b.pullCircle=b.R.circle(a?c+252:c+102,d,5).attr({fill:"#ddd","stroke-width":0,"stroke-opacity":0});b.circleHelp=b.R.circle(c+102,d,5).attr({fill:"#777","stroke-width":0,"stroke-opacity":0,opacity:0});b.pull=b.R.rect(c,d-40,120,80).attr({fill:"#222",opacity:0,"stroke-width":0,"stroke-opacity":0,cursor:"pointer"});b.pull.drag(b._handleMove,b._handleStart,b._handleStop,b);b.pull.mouseover(function(){b._mouseOver(b)}).mouseout(function(){b._mouseOut(b)});if(a){var l=300;b.line.animate({path:"M66,"+b.winHeight+"L200,0"},l);b.pullCircle.attr("opacity",0).animate({cx:c+102,opacity:1},l);b.pullLabel.attr("opacity",0).animate({x:c+50,opacity:1},l);b.square.animate({path:"M"+e.x+","+e.y+"L"+f.x+","+f.y+"L"+g.x+","+g.y+"L"+h.x+","+h.y+"Z"},l);b.blob.animate({path:b._getBlobPath(g,h,e,f,0)},l)}},_mouseOver:function(a){if(a.isDragging)return;var b=a.nameX+a.offsetX;a.pullLabel.animate({x:b+30,opacity:0},100);a.pullHelp.animate({x:b+50,opacity:1},100);a.squareHelp.animate({opacity:1,transform:"t-100,0"},100);a.circleHelp.animate({opacity:1,transform:"t-100,0"},100)},_mouseOut:function(a){if(a.isDragging)return;var b=a.nameX+a.offsetX;a.pullLabel.animate({x:b+50,opacity:1},100);a.pullHelp.animate({x:b+80,opacity:0},100);a.squareHelp.animate({opacity:0,transform:"t0,0"},100);a.circleHelp.animate({opacity:0,transform:"t0,0"},100)},_handleMove:function(a,b,c,d,e,f){this._move(false,a,b)},_handleStart:function(){this._mouseOut(this);this.isDragging=true},_handleStop:function(a){var b=this;if(a.pageX<Math.round(b.winWidth*.66)){b.isMenu=true;b.pull.undrag()}else{b.pull.mouseover(function(){b._mouseOver(b)}).mouseout(function(){b._mouseOut(b)})}this._move(true,0,0)},_move:function(a,b,c){var d=this,e=d._getLatestCoords(b,c),f="M"+(66+Math.round(Math.abs(b)/3))+","+d.winHeight+"L"+(200+Math.abs(b))+",0";if(a){var g=300,h="easeOut";d.pull.animate({x:e.pullX,y:e.pullY-40},g,h);d.pullLabel.animate({x:e.pullX+50,y:e.pullY},g,h);d.pullCircle.animate({cx:e.pullX+102,cy:e.pullY},g,h);d.square.animate({path:e.path},g,h);d.blob.animate({path:e.blobPath},g,h,function(){if(d.isMenu){d._initMenu(e.left,e.top,e.right,e.bottom,e.center)}d.isDragging=false});d.line.animate({path:f},g)}else{d.pull.attr({x:e.pullX,y:e.pullY-40});d.pullLabel.attr({x:e.pullX+50,y:e.pullY});d.pullCircle.attr({cx:e.pullX+102,cy:e.pullY});d.square.attr("path",e.path);d.blob.attr("path",e.blobPath);d.line.attr("path",f)}},_getBlobPath:function(a,b,c,d,e){var f=Math.abs(e/10)+20,g={x:Math.round((c.x+d.x)/2),y:Math.round((c.y+d.y)/2)},h={x:Math.round((a.x+d.x)/2),y:Math.round((a.y+d.y)/2)},i={x:Math.round((c.x+b.x)/2),y:Math.round((c.y+b.y)/2)},j={x:Math.round((a.x+b.x)/2),y:Math.round((a.y+b.y)/2)};var k="";k+="M"+(a.x-f)+","+a.y;k+="R"+j.x+","+j.y;k+=","+b.x+","+(b.y-f);k+=","+i.x+","+i.y;k+=","+(c.x+f)+","+c.y;k+=","+g.x+","+g.y;k+=","+d.x+","+(d.y+f);k+=","+h.x+","+h.y;k+=","+(a.x-f)+","+a.y;return k},_initMenu:function(a,b,c,d,e){var f=this;if(f.line){f.line.remove();f.line=null}if(f.pull){f.pull.remove();f.pull=null}if(f.pullCircle){f.pullCircle.remove();f.pullCircle=null}if(f.pullLabel){f.pullLabel.animate({opacity:0},300,function(){f.pullLabel.remove();f.pullLabel=null})}if(f.blob&&f.blob.type!="circle"){f.blob.remove();f.blob=f.R.circle(e.x,e.y,79).attr({scale:[.1,.1],fill:"#161616","stroke-width":"0","stroke-opacity":"0"})}else{f.blob.attr({cx:e.x,cy:e.y})}var g={fill:"#ddd","stroke-width":0,"stroke-opacity":0,opacity:.5},h={fill:"#333",opacity:0,"stroke-width":0,"stroke-opacity":0,cursor:"pointer"},i={font:"8px Copy0855",fill:"#ffffff",cursor:"pointer",opacity:0},j=[a,d,c,b],k=["about","work","stuffs","links"];var l=f.R.circle(a.x,a.y,3).attr(g),m=f.R.circle(d.x,d.y,3).attr(g),n=f.R.circle(c.x,c.y,3).attr(g),o=f.R.circle(b.x,b.y,3).attr(g);var p=f.R.text(a.x-30,a.y,"About").attr(i),q=f.R.text(d.x,d.y+20,"Work").attr(i),r=f.R.text(c.x+30,c.y,"Stuffs").attr(i),s=f.R.text(b.x,b.y-20,"Links").attr(i);var t=f.R.rect(a.x-100,a.y-50,120,100).attr(h).toFront(),u=f.R.rect(d.x-50,d.y-20,100,120).attr(h).toFront(),v=f.R.rect(c.x-20,c.y-50,120,100).attr(h).toFront(),w=f.R.rect(b.x-50,b.y-100,100,120).attr(h).toFront();var x="/img/site/",y=182,z=182,A=e.x-Math.round(y/2),B=e.y-Math.round(z/2),C=f._createImage(x+"menu-about.png",A,B,y,z),D=f._createImage(x+"menu-work.png",A,B,y,z),E=f._createImage(x+"menu-stuffs.png",A,B,y,z),F=f._createImage(x+"menu-links.png",A,B,y,z);f.circles=[l,m,n,o];f.labels=[p,q,r,s];f.areas=[t,u,v,w];f.images=[C,D,E,F];$.each(f.areas,function(e,g){f._addEvents(e,g,f.circles,f.labels,f.images,j,k,a,b,c,d)})},_createImage:function(a,b,c,d,e){if(this.R){var f=this.R.image(a,b,c,d,e);f.animate({opacity:0,transform:"s0.6,0.6"},5);return f}},_addEvents:function(a,b,c,d,e,f,g,h,i,j,k){var l=this;b.mousemove(function(b,f,g){var m=f+30,n=g,o=f,p=g,q="M"+m+","+n+"L"+i.x+","+i.y+"L"+j.x+","+j.y+"L"+k.x+","+k.y+"Z";if(a==1){m=f;n=g-20;q="M"+h.x+","+h.y+"L"+i.x+","+i.y+"L"+j.x+","+j.y+"L"+m+","+n+"Z"}else if(a==2){m=f-30;q="M"+h.x+","+h.y+"L"+i.x+","+i.y+"L"+m+","+n+"L"+k.x+","+k.y+"Z"}else if(a==3){m=f;n=g+20;q="M"+h.x+","+h.y+"L"+m+","+n+"L"+j.x+","+j.y+"L"+k.x+","+k.y+"Z"}e[a].animate({opacity:1,transform:"s1,1"},100);c[a].attr({cx:m,cy:n,opacity:1});d[a].attr({x:o,y:p,opacity:1});l.square.attr({path:q})}).mouseout(function(){var b=200;c[a].animate({cx:f[a].x,cy:f[a].y,opacity:.5},b);var g=h.x-30,m=h.y;if(a==1){g=k.x;m=k.y+20}else if(a==2){g=j.x+30;m=j.y}else if(a==3){g=i.x;m=i.y-20}d[a].animate({x:g,y:m,opacity:0},b);var n="M"+h.x+","+h.y+"L"+i.x+","+i.y+"L"+j.x+","+j.y+"L"+k.x+","+k.y+"Z";l.square.animate({path:n},b);e[a].animate({opacity:0,transform:"s0.6,0.6"},100)}).click(function(){PF.AppRouter.navigate(g[a],true)})},_moveMenu:function(){var a=this._getLatestCoords();this.square.attr({path:a.path});$.each(this.circles,function(a,b){if(b)b.remove()});$.each(this.areas,function(a,b){if(b)b.remove()});$.each(this.labels,function(a,b){if(b)b.remove()});this._initMenu(a.left,a.top,a.right,a.bottom,a.center)},_getLatestCoords:function(a,b){var c={},d=a||0,e=b||0;c.pullX=this.isMenu?Math.round(this.winWidth*.33):this.nameX+d+this.offsetX;c.pullY=this.nameY+e+this.offsetY;c.halfY=this.nameY+this.offsetY;c.middleX=this.nameX+Math.round(d/3)+this.offsetX;c.left={x:c.pullX+this.initialOffset,y:c.pullY};c.top={x:this.isMenu?c.left.x+70:c.middleX+this.offsetLeftX,y:this.isMenu?c.pullY-140:-100};c.right={x:this.isMenu?c.left.x+216:this.winWidth+200,y:this.isMenu?c.left.y-57:c.halfY};c.bottom={x:this.isMenu?c.left.x+135:c.middleX+this.offsetLeftX,y:this.isMenu?c.left.y+85:this.winHeight+100};c.center={x:Math.round((c.left.x+c.right.x)/2)-1,y:Math.round((c.top.y+c.bottom.y)/2)};c.path="M"+c.left.x+","+c.left.y;c.path+="L"+c.top.x+","+c.top.y;c.path+="L"+c.right.x+","+c.right.y;c.path+="L"+c.bottom.x+","+c.bottom.y+"Z";c.blobPath=this._getBlobPath(c.right,c.bottom,c.left,c.top,d);return c}});PF.View.Links=Backbone.View.extend({el:"#page .content",page:"#page",tpl_links:null,collection:null,totalImages:0,indexLoaded:0,toggleLists:function(a,b){if($(a).hasClass("selected"))return;$(".content .selected").removeClass("selected");$(a).addClass("selected");var c=b?"0px":"-127px";$(".container").animate({"margin-left":c},500,"linear");$(".a-z ul").animate({opacity:b?1:0},400,"linear");$(".gobelins ul").animate({opacity:b?0:1},400,"linear");$(".line").toggleClass("line-toggled")},hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(){this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_links){a._loadData()}else{$.loadTemplate({template:"template_links",file:"/templates/links.html",callback:function(b){a.tpl_links=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(a.collection){a._display()}else{a.collection=new PF.Collection.LinksCollection;$.ajax({dataType:"json",url:"/data/links.json",success:function(b){a.totalImages=b.az.length+b.gobelins.length-1;_.each(b.az,function(b,c){a.collection.add(new PF.Model.Link({name:b.name,url:b.url,slug:b.slug,type:"az"}));a._loadImage(b.slug)});_.each(b.gobelins,function(b,c){a.collection.add(new PF.Model.Link({name:b.name,type:"gobelins",isSubtitle:true,"class":c!=0}));a.indexLoaded++;_.each(b.people,function(c){a.collection.add(new PF.Model.Link({name:c.name,url:c.url,slug:c.slug,type:"gobelins"}));a._loadImage(b.slug)})})}})}},_loadImage:function(a){var b=this,c=new Image;c.onload=function(){$(".content-loading").show().text("Loading... "+Math.round(b.indexLoaded*100/b.totalImages)+"%");if(b.indexLoaded==b.totalImages)b._display();b.indexLoaded++};c.src="/img/links/external/"+a+".jpg"},_display:function(){var a=this,b={links:this.collection.models},c=_.template(this.tpl_links),d=$(".line");$(".content-loading").hide();if(d.length==0)$(a.page).append('<div class="line"></div>');else d.removeClass("line-toggled");$(this.el).html(c(b)).fadeIn(300,function(){a._initLinks()})},_initLinks:function(){var a=this;$(".link-az").click(function(b){b.preventDefault();a.toggleLists(this,true)});$(".link-gobelins").click(function(b){b.preventDefault();a.toggleLists(this,false)});$(".container ul li a").hover(function(){var a="/img/links/external/"+$(this).data("slug")+".jpg";$("nav .selected span").css({"background-image":"url("+a+")","background-position":"50% -5px"})},function(){$("nav .selected span").css({"background-position":"50% 100px"})})}});PF.View.Nav=Backbone.View.extend({nav:null,footer:null,breadcrumb:null,currentViewID:null,initialize:function(){var a=this;a.nav=$("nav");a.footer=$("footer");a.breadcrumb=$(".breadcrumb");$("nav a:not(.selected)").live({mouseenter:function(){if(a.breadcrumb.find(".link").length>1)a.breadcrumb.find(".link:last").hide(200);var b=$("span",this).text();b.shuffle(a.breadcrumb.find(".current"))},mouseleave:function(){if(a.breadcrumb.find(".link").length>1)a.breadcrumb.find(".link:last").show(200);a.breadcrumbText=a.currentViewID.capitalize();a.breadcrumbText.shuffle(a.breadcrumb.find(".current"))}});$("nav a").click(function(a){a.preventDefault();if($(this).hasClass("selected"))return;PF.AppRouter.navigate($(this).attr("href"),true)});$(".link-first").live("click",function(a){a.preventDefault();PF.AppRouter.navigate("/",true)})},order:function(a){$("body").attr("class","").addClass("page-"+a);this.nav.find(".selected").removeClass("selected");$("#"+a).removeClass("first").removeClass("second").removeClass("third").addClass("selected");this.nav.find("a:not(.selected)").each(function(a,b){$(b).removeClass("first").removeClass("second").removeClass("third").addClass(a==0?"first":a==1?"second":"third");$("span",b).css("background-image","")});return this},updateBreadcrumb:function(a){this.breadcrumbText=a.capitalize();$(".current",this.breadcrumb).text(this.breadcrumbText)},hide:function(){this.nav.fadeOut(200);this.footer.fadeOut(200);this.breadcrumb.fadeOut(200)},render:function(a){var b=this;if(this.nav.hasClass("hidden")){this.nav.css("visibility","visible").fadeIn(200,function(){b.nav.removeClass("hidden")})}if(this.footer.hasClass("hidden")){this.footer.css("visibility","visible").fadeIn(200,function(){b.footer.removeClass("hidden")})}if(this.breadcrumb.hasClass("hidden")){this.breadcrumb.css("visibility","visible").fadeIn(200,function(){b.breadcrumb.removeClass("hidden")})}if(a){this.order(a);this.updateBreadcrumb(a);this.currentViewID=a}}});PF.View.Stuffs=Backbone.View.extend({el:"#page .content",$el:null,tpl_stuffs:null,collection:null,currentSlug:null,$window:$(window),$body:$("body"),initialize:function(){var a=this;a.$el=$(a.el);a.$window.resize(function(){if(!a.$body.hasClass("page-stuffs")){a.$el.css("width",a.$window.width()-545);a._updateNavPos(true)}})},hide:function(a){this.$el.hide().css("width","");if(a)PF.EventManager.trigger(a)},render:function(a){this.currentSlug=a||null;this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_stuffs){a._loadData()}else{$.loadTemplate({template:"template_stuffs",file:"/templates/stuffs.html",callback:function(b){a.tpl_stuffs=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(a.collection){a._display()}else{a.collection=new PF.Collection.StuffsCollection;$.ajax({dataType:"json",url:"/data/stuffs.json",success:function(b){var c=b.stuffs.length-1,d=0,e=$(".content-loading");e.show();$.each(b.stuffs,function(b,f){a.collection.add(new PF.Model.Stuff({index:f.index,slug:f.slug,title:f.title,top:f.top,date:f.date,img:f.img,videoType:f.videoType,videoId:f.videoId,text:f.text,tags:f.tags}));if(f.img){var g=new Image;g.onload=function(){e.text("Loading... "+Math.round(d*100/c)+"%");if(d==c)a._display();d++};g.src="/img/stuffs/"+f.img}else{if(d==c)a._display();d++}})}})}},_updateImage:function(){var a=$(".content ul li:not(.hidden)").data("img");$("nav .selected span").css("background-image","url(/img/stuffs/"+a+")")},_updateNavPos:function(a){var b=this.collection.length,c=b*35+85,d=Math.floor(b/2),e=b-1-$(".nav-stuffs li.current").data("index"),f=Math.round(($(window).height()-c)/2),g=35*(d-e),h=$(".nav-stuffs");if(a)h.css("top",Math.round(f+g));else h.animate({top:Math.round(f+g)},200)},_initNavLinks:function(){var a=this;$(".nav-stuffs a").click(function(b){b.preventDefault();PF.AppRouter.navigate($(this).attr("href"));a._changePartial($(this).data("slug"))});$(window).keydown(function(b){if(!$("body").hasClass("page-stuffs"))return;var c=a.$el.find(".nav-stuffs"),d=c.find(".current"),e=d.data("index");if(b.keyCode==38&&e<a.collection.length-1){var f=c.find("li[data-index="+(e+1)+"] a").data("slug");a._changePartial(f);PF.AppRouter.navigate("/stuffs/"+f)}else if(b.keyCode==40&&e>0){var g=c.find("li[data-index="+(e-1)+"] a").data("slug");a._changePartial(g);PF.AppRouter.navigate("/stuffs/"+g)}})},_display:function(){var a=this,b={stuffs:this.collection.models,selectedSlug:this.currentSlug,baseTop:Math.round(this.$window.height()/2)},c=_.template(this.tpl_stuffs);$(".content-loading").hide();this.$el.html(c(b)).fadeIn(300,function(){a._initNavLinks();a._updateImage();a.$el.css("width",a.$window.width()-545);a._updateNavPos(true);a._initVideo($("ul.articles li:not(.hidden) .stuff-content"))})},_changePartial:function(a){var b=$("ul.articles"),c=b.find("li:not(.hidden)"),d=b.find("li[data-slug="+a+"]"),e=c.data("slug"),f=c.data("index"),g=d.data("index"),h=$("ul.nav-stuffs"),i=h.find("li.current"),j=h.find("li[data-index="+g+"]"),k=c.find("span.stuff-content"),l=d.find("span.stuff-content");if(a==e)return;i.removeClass("current");j.addClass("current");this._updateNavPos();this._initVideo(d.find(".stuff-content"),c.find(".stuff-content"));var m=this;k.stop(true,true).animate({opacity:0,top:f>g?"70%":"30%"},400,function(){c.addClass("hidden");m._updateImage();k.css({top:k.data("top"),opacity:1})});d.removeClass("hidden");l.css({top:f>g?"30%":"70%",opacity:0}).stop(true,true).animate({opacity:1,top:l.data("top")},400)},_initVideo:function(a,b){if(b)b.find("iframe").remove();var c=a.data("video-type"),d=a.data("video-id"),e=a.data("color"),f="";switch(c){case"youtube":f='<iframe width="435" height="251" src="http://www.youtube.com/embed/'+d+'?rel=0" frameborder="0" allowfullscreen></iframe>';break;case"vimeo":f='<iframe src="http://player.vimeo.com/video/'+d+"?title=0&byline=0&portrait=0&color="+e+'" width="435" height="261" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';break}if(c){$(f).insertAfter(a.find(".title"))}}});PF.View.Work=Backbone.View.extend({el:"#page .content",$el:null,tpl_work:null,collection:null,currentSlug:null,lines:null,ordered:null,percent:null,connection:null,offsetX:0,offsetY:0,$window:null,$body:null,width:0,height:0,initialize:function(){var a=this;a.$window=$(window);a.$body=$("body");a.$el=$(a.el);a.$window.resize(function(){if(a.$body.hasClass("page-work")){var b=$("#works-lines").position();if(b){a.offsetX=b.left;a.offsetY=b.top}a._drawLinks(true)}})},hide:function(a){this.$el.hide();if(a)PF.EventManager.trigger(a)},render:function(a){this.currentSlug=a;this._loadTemplate()},_loadTemplate:function(){var a=this;if(a.tpl_work){a._loadData()}else{$.loadTemplate({template:"template_work",file:"/templates/work.html",callback:function(b){a.tpl_work=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;if(this.collection){a._display()}else{a.collection=new PF.Collection.WorksCollection;$.ajax({dataType:"json",url:"/data/works.json",success:function(b){var c=b.projects.length-1,d=0,e=$(".content-loading");e.show();$.each(b.projects,function(b,f){a.collection.add(new PF.Model.Work({index:f.index,color:f.color,name:f.slug,slug:f.slug,title:f.title,featured:f.featured,context:f.context,link:f.link,linkText:f.linkText,white:f.white,videoType:f.videoType,videoId:f.videoId,text:f.text,tags:f.tags,slides:f.slides}));var g=new Image;g.onload=function(){e.text("Loading... "+Math.round(d*100/c)+"%");if(d==c)a._display();d++};g.src="/img/work/projects/"+f.slug+".jpg"})}})}},_display:function(){var a=this,b={projects:this.collection.models},c=_.template(this.tpl_work);$(".content-loading").hide();this.$el.html(c(b)).fadeIn(300,function(){var b=$("#works-lines").position();a.offsetX=b.left;a.offsetY=b.top;a._drawLinks();a._cleanup();if(a.currentSlug){PF.AppRouter.navigate("/work/"+a.currentSlug,true);a.currentSlug=null}})},_drawLinks:function(a){if(this.lines)this.lines.clear();this.lines=Raphael(document.getElementById("works-lines"),"100%","100%");var b=this,c="";this.width=Math.round(this.$window.width()/2),this.height=Math.round(this.$window.height()/2);this.connection=this.lines.path(c).attr({stroke:"#333"});if(a){$.each(this.percent,function(a,d){var e=Math.round(d[0]*b.width/100)+25,f=Math.round(d[1]*b.height/100)+25;if(a==0)c="M"+e+","+f;else if(a==1)c+="L"+e+","+f;else c+=" "+e+","+f;b.connection.attr("path",c);b._drawLink(b.collection.models[a],a,false)})}else{this.ordered=[],this.percent=[];var d=[20,30,40,50,60,70,80,85,90],e=[10,20,30,40,50,60,70,80,85];d=$.shuffle(d);e=$.shuffle(e);$.each(this.collection.models,function(a,f){var g=Math.round(d[a]*b.width/100)+25,h=Math.round(e[a]*b.height/100)+25;b.ordered.push([g,h]);b.percent.push([d[a],e[a]]);f.set("position",[d[a],e[a]]);setTimeout(function(){if(a==0)c="M"+g+","+h;else if(a==1)c+="L"+g+","+h;else c+=" "+g+","+h;b.connection.animate({path:c},150);setTimeout(function(){b._drawLink(f,a,true)},200)},a*200)})}},_drawLink:function(a,b,c){var d=this,e={stroke:"#666","stroke-opacity":0,"stroke-width":0,opacity:.3,fill:"#666"},f={opacity:.3,stroke:"#444","stroke-width":1},g={stroke:"#666","stroke-opacity":0,"stroke-width":0,fill:"#666",opacity:0,cursor:"pointer"},h=a.attributes.featured?5:3,i=a.attributes.featured?8:5,j=Math.round(d.percent[b][0]*d.width/100)+25,k=Math.round(d.percent[b][1]*d.height/100)+25,l=this.lines.circle(j,k,h).attr(e),m=this.lines.circle(j,k,h+i).attr(f),n=this.lines.circle(j,k,h+i*4).attr(g),o="",p=$(".breadcrumb");$.each(d.percent,function(a,b){o+=(a==0?"M":"L")+(Math.round(b[0]*d.width/100)+25)+","+(Math.round(b[1]*d.height/100)+25)});if(c){l.scale(0,0).animate({transform:"s1,1"},500,"easeout");m.scale(0,0).animate({transform:"s1,1"},500)}$(n).data("link",a.attributes);n.mouseover(function(){l.attr("opacity",1);m.attr("opacity",1);p.find(".current:first").removeClass("current").addClass("link");setTimeout(function(){p.find(".link:last").css("font-family","Copy0855")},180);$("<span> / </span>").appendTo(p.find(".link:last"));var a=$(this).data("link");$('<li class="current">'+a.title.substring(0,2)+"</li>").appendTo(p).show();a.title.shuffle(p.find(".current:last"));var b="/img/work/projects/"+a.slug+".jpg";$("nav .selected span").css({"background-image":"url("+b+")","background-position":"50% -5px"})}).mouseout(function(){l.animate({cx:j,cy:k,opacity:.3},200);m.animate({cx:j,cy:k,opacity:.3},200);d.connection.animate({path:o},200);p.find(".link:last").removeClass("link").addClass("current").css("font-family","");p.find(".current:first span").remove();p.find(".current:last").remove();$("nav .selected span").css({"background-position":"50% 100px"})}).mousemove(function(a,c,e){var f=c-d.offsetX,g=e-d.offsetY+($.browser.webkit?20:200);l.attr({cx:f,cy:g});m.attr({cx:f,cy:g});var h="";$.each(d.percent,function(a,c){var e=Math.round(c[0]*d.width/100)+25,i=Math.round(c[1]*d.height/100)+25;h+=(a==0?"M":"L")+(a==b?f+","+g:e+","+i)});d.connection.attr("path",h)}).click(function(){PF.AppRouter.navigate("/work/"+a.attributes.slug,true)})},_cleanup:function(){$("#detail-background").empty();$("#detail").html("Loading Details...")}});PF.View.WorkDetail=Backbone.View.extend({el:"#detail-container",$el:null,tpl_work_detail:null,collection:null,currentSlug:null,currentWork:null,winWidth:null,winHeight:null,block:null,whiteBG:null,initialize:function(){var a=this;a.$el=$(a.el);a.winWidth=$(window).width();a.winHeight=$(window).height();a.$block=a.$el.find("#detail");$(window).resize(function(){a.winWidth=$(window).width();a.winHeight=$(window).height();if(a.whiteBG){a._updateNavPos(true);var b="M20,20",c="L"+(a.winWidth-20)+",20",d=" "+(a.winWidth-20)+","+(a.winHeight-40),e=" "+(a.winWidth-380)+","+(a.winHeight-20),f=" 20,"+(a.winHeight-30),g=" 20,20",h=b+c+d+e+f+g;a.whiteBG.attr("path",h)}if(a.rightColor){var i="M"+(a.winWidth-20)+",20L"+(a.winWidth-20)+","+(a.winHeight-40)+" "+(a.winWidth-30)+","+(a.winHeight-39)+" "+(a.winWidth-70)+", 20Z";a.rightColor.attr("path",i)}});$(window).keydown(function(b){if(!$("body").hasClass("page-work-detail"))return;var c=a.currentWork.attributes.index,d=$(".project-detail > li:not(.hidden)");if(b.keyCode==40&&c>0){a._nextItem(a.collection.at(c-1).attributes.slug)}else if(b.keyCode==38&&c<a.collection.length-1){a._nextItem(a.collection.at(c+1).attributes.slug)}else if(b.keyCode==37){a._navigate("prev",d)}else if(b.keyCode==39){a._navigate("next",d)}})},hide:function(a){$(this.el).hide();if(a)PF.EventManager.trigger(a)},render:function(a,b){var c=this;c.currentSlug=a;c.collection=b;if($(".page-work").hasClass("page-work-detail")){this._nextItem(a)}else{this._loadTemplate()}},_loadTemplate:function(){var a=this;if(a.tpl_work){a._loadData()}else{$.loadTemplate({template:"template_work_detail",file:"/templates/work_detail.html",callback:function(b){a.tpl_work_detail=b;a._loadData()},noStorage:true})}},_loadData:function(){var a=this;$.each(this.collection.models,function(b,c){if(c.attributes.slug==a.currentSlug)a.currentWork=c});this._display()},_display:function(){$("body").addClass("page-work-detail");this.$el.show();this._drawBlock()},_drawBlock:function(){var a=this,b=this.winWidth,c=this.winHeight,d={"stroke-opacity":0,"stroke-width":0,stroke:"#ffffff",fill:"#ffffff"},e=Math.round(b/2),f=Math.round(c/2),g="M"+e+","+(f-20),h="L"+(e+20)+","+f,i=" "+e+","+(f+20),j=" "+(e-20)+","+f,k=" "+(e-20)+","+f,l=" "+e+","+(f-20),m=g+h+i+j+k+l,n="M"+(e-200)+","+(f+200),o="L"+(e-200)+","+(f-200),p=" "+(e+200)+","+(f-200),q=" "+(e+200)+","+(f+200),r=" "+(e+200)+","+(f+200),s=" "+(e-200)+","+(f+200),t=n+o+p+q+r+s,u="M20,20",v="L"+(b-20)+",20",w=" "+(b-20)+","+(c-40),x=" "+(b-380)+","+(c-20),y=" 20,"+(c-30),z=" 20,20",A=u+v+w+x+y+z;if(!this.block){this.block=Raphael(document.getElementById("detail-background"),"100%","100%")}this.whiteBG=this.block.path(m).attr(d).animate({path:t},400,"<",function(){$("#detail").css({left:e-40,top:f-5}).fadeIn(100);setTimeout(function(){$("#detail").css({left:0,top:0}).fadeOut(50);a.whiteBG.animate({path:A},400,"<",function(){$(window).resize();a._initContent()})},500)})},_initContent:function(){var a=this,b={projects:this.collection.models,selectedSlug:this.currentWork.attributes.slug,_:_},c=_.template(this.tpl_work_detail);this.$block.html(c(b)).fadeIn(300,function(){a._drawRightColor();a._initHTML()})},_drawRightColor:function(){var a=this.winWidth,b=this.winHeight,c="M"+(a-20)+",20L"+(a-20)+","+(b-40)+" "+(a-20)+","+(b-40)+" "+(a-20)+", 20Z",d="M"+(a-20)+",20L"+(a-20)+","+(b-40)+" "+(a-30)+","+(b-39)+" "+(a-70)+", 20Z";this.rightColor=this.block.path(c).attr({"stroke-opacity":0,"stroke-width":0,stroke:"#"+this.currentWork.attributes.color,fill:"#"+this.currentWork.attributes.color}).animate({path:d},250,">")},_initHTML:function(){var a=$(".project-detail > li:not(.hidden)");this._initCarousel(a);this._updateCloseBtn();this._updateNavPos();this._updateBreadcrumb();var b=this;b.$el.find(".nav-work-details li").live({click:function(a){a.preventDefault();b._nextItem($(this).data("slug"))},mouseover:function(){if($(this).hasClass("current"))return;b._updateBreadcrumb($(this).data("index"))},mouseleave:function(){if($(this).hasClass("current"))return;b._updateBreadcrumb($(".nav-work-details li.current").data("index"))}});this.$el.delegate(".close-detail","click",function(a){a.preventDefault();var c=Math.round(b.winWidth/2),d=Math.round(b.winHeight/2),e="M"+c+","+(d-20),f="L"+(c+20)+","+d,g=" "+c+","+(d+20),h=" "+(c-20)+","+d,i=" "+(c-20)+","+d,j=" "+c+","+(d-20),k=e+f+g+h+i+j,l="M"+(c-200)+","+(d+200),m="L"+(c-200)+","+(d-200),n=" "+(c+200)+","+(d-200),o=" "+(c+200)+","+(d+200),p=" "+(c+200)+","+(d+200),q=" "+(c-200)+","+(d+200),r=l+m+n+o+p+q;$("#detail").empty();b.rightColor.animate({opacity:0},150);b.whiteBG.animate({path:r},200,function(){b.whiteBG.animate({path:k},200,function(){b.block=null;$(".page-work").removeClass("page-work-detail");PF.AppRouter.navigate("work",true)})})})},_updateCloseBtn:function(){var a=this.$el.find(".close-detail"),b=this.$el.find(".nav-work-details .current").data("white");if(b)a.addClass("white");else a.removeClass("white")},_updateNavPos:function(a){var b=this.$el.find(".nav-work-details"),c=Math.floor(b.find("li").length/2),d=b.find("li.current").data("index"),e=Math.round((this.winHeight-b.height())/2),f=24*(c-d);if(a)b.css("top",Math.round(e-f));else b.animate({top:Math.round(e-f)},200)},_updateBreadcrumb:function(a){var b=this.$el.find(".nav-work-details li.current").data("index"),c=this.collection.models[a>=0?a:b].attributes.title;this.$el.find(".breadcrumb-work-details a.slug").html(c)},_nextItem:function(a){var b=this.$el.find(".nav-work-details"),c=$(".project-detail > li:not(.hidden)"),d=$(".project-detail > li[data-slug="+a+"]"),e=c.data("slug"),f=b.find(".current"),g=b.find("li[data-slug="+a+"]"),h=this.$el.find(".list-tags"),i=h.find("li:not(.hidden)"),j=h.find("li[data-slug="+a+"]");if(a==e)return;PF.AppRouter.navigate("/work/"+a);f.removeClass("current");g.addClass("current");c.addClass("hidden");d.removeClass("hidden");i.addClass("hidden");j.removeClass("hidden");if(this.rightColor){var k="#"+(d.data("color")||"000000");this.rightColor.attr({stroke:k,fill:k})}this._initVideo(d.find(".active"),c.find(".active"));this._initCarousel(d);this._updateCloseBtn();this._updateNavPos();this._updateBreadcrumb();var l=this;$.each(this.collection.models,function(b,c){if(c.attributes.slug==a)l.currentWork=c})},_getCircletoPath:function(a,b,c){var d="M";d=d+""+a+","+(b-c)+"A"+c+","+c+",0,1,1,"+(a-.1)+","+(b-c)+"z";return d},_initVideo:function(a,b){if(b){b.find("iframe").remove();b.find("video").remove()}if(!a)return;var c=a.data("video-type"),d=a.data("video-id"),e="";switch(c){case"youtube":e='<iframe width="750" height="470" src="http://www.youtube.com/embed/'+d+'?rel=0" frameborder="0" allowfullscreen></iframe>';break;case"vimeo":e='<iframe src="http://player.vimeo.com/video/'+d+'?title=0&byline=0&portrait=0" width="750" height="470" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';break;case"mp4":e='<video src="'+d+'" class="jwplayer" height="470" width="750"></video>';break;case"swf":e='<iframe frameborder="0" src="/img/work/projects/nokia-push/nokia-push.swf" width="550" height="192" style="margin:170px 0 0 100px;"></iframe>';break}if(c){a.prepend($(e))}},_initCarousel:function(a){if(a.data("carousel-index")>0)$(".breadcrumb-work-details").fadeOut(300);else $(".breadcrumb-work-details").fadeIn(300);if(a.data("carousel"))return;var b=this;a.data("carousel",true);a.data("carousel-index","0");a.delegate(".next","click",function(c){c.preventDefault();b._navigate("next",a)});a.delegate(".prev","click",function(c){c.preventDefault();b._navigate("prev",a)})},_navigate:function(a,b){var c=b.find(".item").length-1,d=0,e=parseInt(b.data("carousel-index"))||0;if(a=="next"){if(e>=c)return;e++;if(e>=c)b.find(".next").addClass("disable");b.find(".prev").removeClass("disable")}else if(a=="prev"){if(e<=d)return;e--;if(e<=d)b.find(".prev").addClass("disable");b.find(".next").removeClass("disable")}var f=b.find(".active");var g=b.find(".item").get(e);f.removeClass("active");$(g).addClass("active");this._initVideo($(g),f);b.find(".scrollable-title").text(b.find(".active .title").text()||"");var h=e>0?b.find(".active .link-project").clone():b.find(".active .base-link").clone();if(e==0){h.removeClass("base-link").addClass("link-project").addClass("transition")}b.find(".scrollable-link").empty().append(h);if(e>0)$(".breadcrumb-work-details").fadeOut(300);else $(".breadcrumb-work-details").fadeIn(300);b.find(".items").animate({left:-750*e},300);b.data("carousel-index",e)}})